{
    "m1": "aW1wb3J0IG9zDQppbXBvcnQganNvbiBhcyBqc29uZCAgIyBqc29uDQppbXBvcnQgdGltZSAgIyBzbGVlcCBiZWZvcmUgZXhpdA0KaW1wb3J0IGJpbmFzY2lpICAjIGhleCBlbmNvZGluZw0KZnJvbSB1dWlkIGltcG9ydCB1dWlkNCAgIyBnZW4gcmFuZG9tIGd1aWQNCmltcG9ydCBwbGF0Zm9ybSAgIyBjaGVjayBwbGF0Zm9ybQ0KaW1wb3J0IHN1YnByb2Nlc3MgICMgbmVlZGVkIGZvciBtYWMgZGV2aWNlDQoNCnRyeToNCiAgICBpZiBvcy5uYW1lID09ICdudCc6DQogICAgICAgIGltcG9ydCB3aW4zMnNlY3VyaXR5ICAjIGdldCBzaWQgKFdJTiBvbmx5KQ0KICAgIGltcG9ydCByZXF1ZXN0cyAgIyBodHRwcyByZXF1ZXN0cw0KICAgIGZyb20gQ3J5cHRvLkNpcGhlciBpbXBvcnQgQUVTDQogICAgZnJvbSBDcnlwdG8uSGFzaCBpbXBvcnQgU0hBMjU2DQogICAgZnJvbSBDcnlwdG8uVXRpbC5QYWRkaW5nIGltcG9ydCBwYWQsIHVucGFkDQpleGNlcHQgTW9kdWxlTm90Rm91bmRFcnJvcjoNCiAgICBwcmludCgiRXhjZXB0aW9uIHdoZW4gaW1wb3J0aW5nIG1vZHVsZXMiKQ0KICAgIHByaW50KCJJbnN0YWxsaW5nIG5lY2Vzc2FyeSBtb2R1bGVzLi4uLiIpDQogICAgaWYgb3MucGF0aC5pc2ZpbGUoInJlcXVpcmVtZW50cy50eHQiKToNCiAgICAgICAgb3Muc3lzdGVtKCJwaXAgaW5zdGFsbCAtciByZXF1aXJlbWVudHMudHh0IikNCiAgICBlbHNlOg0KICAgICAgICBvcy5zeXN0ZW0oInBpcCBpbnN0YWxsIHB5d2luMzIiKQ0KICAgICAgICBvcy5zeXN0ZW0oInBpcCBpbnN0YWxsIHB5Y3J5cHRvZG9tZSIpDQogICAgICAgIG9zLnN5c3RlbSgicGlwIGluc3RhbGwgcmVxdWVzdHMiKQ0KICAgIHByaW50KCJNb2R1bGVzIGluc3RhbGxlZCEiKQ0KICAgIHRpbWUuc2xlZXAoMS41KQ0KICAgIG9zLl9leGl0KDEpDQoNCnRyeTogICMgQ29ubmVjdGlvbiBjaGVjaw0KICAgIHMgPSByZXF1ZXN0cy5TZXNzaW9uKCkgICMgU2Vzc2lvbg0KICAgIHMuZ2V0KCdodHRwczovL2dvb2dsZS5jb20nKQ0KZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOg0KICAgIHByaW50KGUpDQogICAgdGltZS5zbGVlcCgzKQ0KICAgIG9zLl9leGl0KDEpDQoNCg0KY2xhc3MgYXBpOg0KDQogICAgbmFtZSA9IG93bmVyaWQgPSBzZWNyZXQgPSB2ZXJzaW9uID0gaGFzaF90b19jaGVjayA9ICIiDQoNCiAgICBkZWYgX19pbml0X18oc2VsZiwgbmFtZSwgb3duZXJpZCwgc2VjcmV0LCB2ZXJzaW9uLCBoYXNoX3RvX2NoZWNrKToNCiAgICAgICAgc2VsZi5uYW1lID0gbmFtZQ0KDQogICAgICAgIHNlbGYub3duZXJpZCA9IG93bmVyaWQNCg0KICAgICAgICBzZWxmLnNlY3JldCA9IHNlY3JldA0KDQogICAgICAgIHNlbGYudmVyc2lvbiA9IHZlcnNpb24NCiAgICAgICAgc2VsZi5oYXNoX3RvX2NoZWNrID0gaGFzaF90b19jaGVjaw0KICAgICAgICBzZWxmLmluaXQoKQ0KDQogICAgc2Vzc2lvbmlkID0gZW5ja2V5ID0gIiINCiAgICBpbml0aWFsaXplZCA9IEZhbHNlDQoNCiAgICBkZWYgaW5pdChzZWxmKToNCg0KICAgICAgICBpZiBzZWxmLnNlc3Npb25pZCAhPSAiIjoNCiAgICAgICAgICAgIHByaW50KCJZb3UndmUgYWxyZWFkeSBpbml0aWFsaXplZCEiKQ0KICAgICAgICAgICAgdGltZS5zbGVlcCgyKQ0KICAgICAgICAgICAgb3MuX2V4aXQoMSkNCiAgICAgICAgaW5pdF9pdiA9IFNIQTI1Ni5uZXcoc3RyKHV1aWQ0KCkpWzo4XS5lbmNvZGUoKSkuaGV4ZGlnZXN0KCkNCg0KICAgICAgICBzZWxmLmVuY2tleSA9IFNIQTI1Ni5uZXcoc3RyKHV1aWQ0KCkpWzo4XS5lbmNvZGUoKSkuaGV4ZGlnZXN0KCkNCg0KICAgICAgICBwb3N0X2RhdGEgPSB7DQogICAgICAgICAgICAidHlwZSI6IGJpbmFzY2lpLmhleGxpZnkoImluaXQiLmVuY29kZSgpKSwNCiAgICAgICAgICAgICJ2ZXIiOiBlbmNyeXB0aW9uLmVuY3J5cHQoc2VsZi52ZXJzaW9uLCBzZWxmLnNlY3JldCwgaW5pdF9pdiksDQogICAgICAgICAgICAiaGFzaCI6IHNlbGYuaGFzaF90b19jaGVjaywNCiAgICAgICAgICAgICJlbmNrZXkiOiBlbmNyeXB0aW9uLmVuY3J5cHQoc2VsZi5lbmNrZXksIHNlbGYuc2VjcmV0LCBpbml0X2l2KSwNCiAgICAgICAgICAgICJuYW1lIjogYmluYXNjaWkuaGV4bGlmeShzZWxmLm5hbWUuZW5jb2RlKCkpLA0KICAgICAgICAgICAgIm93bmVyaWQiOiBiaW5hc2NpaS5oZXhsaWZ5KHNlbGYub3duZXJpZC5lbmNvZGUoKSksDQogICAgICAgICAgICAiaW5pdF9pdiI6IGluaXRfaXYNCiAgICAgICAgfQ0KDQogICAgICAgIHJlc3BvbnNlID0gc2VsZi5fX2RvX3JlcXVlc3QocG9zdF9kYXRhKQ0KDQogICAgICAgIGlmIHJlc3BvbnNlID09ICJLZXlBdXRoX0ludmFsaWQiOg0KICAgICAgICAgICAgcHJpbnQoIlRoZSBhcHBsaWNhdGlvbiBkb2Vzbid0IGV4aXN0IikNCiAgICAgICAgICAgIG9zLl9leGl0KDEpDQoNCiAgICAgICAgcmVzcG9uc2UgPSBlbmNyeXB0aW9uLmRlY3J5cHQocmVzcG9uc2UsIHNlbGYuc2VjcmV0LCBpbml0X2l2KQ0KICAgICAgICBqc29uID0ganNvbmQubG9hZHMocmVzcG9uc2UpDQoNCiAgICAgICAgaWYganNvblsibWVzc2FnZSJdID09ICJpbnZhbGlkdmVyIjoNCiAgICAgICAgICAgIGlmIGpzb25bImRvd25sb2FkIl0gIT0gIiI6DQogICAgICAgICAgICAgICAgcHJpbnQoIk5ldyBWZXJzaW9uIEF2YWlsYWJsZSIpDQogICAgICAgICAgICAgICAgZG93bmxvYWRfbGluayA9IGpzb25bImRvd25sb2FkIl0NCiAgICAgICAgICAgICAgICBvcy5zeXN0ZW0oZiJzdGFydCB7ZG93bmxvYWRfbGlua30iKQ0KICAgICAgICAgICAgICAgIG9zLl9leGl0KDEpDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHByaW50KCJJbnZhbGlkIFZlcnNpb24sIENvbnRhY3Qgb3duZXIgdG8gYWRkIGRvd25sb2FkIGxpbmsgdG8gbGF0ZXN0IGFwcCB2ZXJzaW9uIikNCiAgICAgICAgICAgICAgICBvcy5fZXhpdCgxKQ0KDQogICAgICAgIGlmIG5vdCBqc29uWyJzdWNjZXNzIl06DQogICAgICAgICAgICBwcmludChqc29uWyJtZXNzYWdlIl0pDQogICAgICAgICAgICBvcy5fZXhpdCgxKQ0KDQogICAgICAgIHNlbGYuc2Vzc2lvbmlkID0ganNvblsic2Vzc2lvbmlkIl0NCiAgICAgICAgc2VsZi5pbml0aWFsaXplZCA9IFRydWUNCiAgICAgICAgc2VsZi5fX2xvYWRfYXBwX2RhdGEoanNvblsiYXBwaW5mbyJdKQ0KDQogICAgZGVmIHJlZ2lzdGVyKHNlbGYsIHVzZXIsIHBhc3N3b3JkLCBsaWNlbnNlLCBod2lkPU5vbmUpOg0KICAgICAgICBzZWxmLmNoZWNraW5pdCgpDQogICAgICAgIGlmIGh3aWQgaXMgTm9uZToNCiAgICAgICAgICAgIGh3aWQgPSBvdGhlcnMuZ2V0X2h3aWQoKQ0KDQogICAgICAgIGluaXRfaXYgPSBTSEEyNTYubmV3KHN0cih1dWlkNCgpKVs6OF0uZW5jb2RlKCkpLmhleGRpZ2VzdCgpDQoNCiAgICAgICAgcG9zdF9kYXRhID0gew0KICAgICAgICAgICAgInR5cGUiOiBiaW5hc2NpaS5oZXhsaWZ5KCJyZWdpc3RlciIuZW5jb2RlKCkpLA0KICAgICAgICAgICAgInVzZXJuYW1lIjogZW5jcnlwdGlvbi5lbmNyeXB0KHVzZXIsIHNlbGYuZW5ja2V5LCBpbml0X2l2KSwNCiAgICAgICAgICAgICJwYXNzIjogZW5jcnlwdGlvbi5lbmNyeXB0KHBhc3N3b3JkLCBzZWxmLmVuY2tleSwgaW5pdF9pdiksDQogICAgICAgICAgICAia2V5IjogZW5jcnlwdGlvbi5lbmNyeXB0KGxpY2Vuc2UsIHNlbGYuZW5ja2V5LCBpbml0X2l2KSwNCiAgICAgICAgICAgICJod2lkIjogZW5jcnlwdGlvbi5lbmNyeXB0KGh3aWQsIHNlbGYuZW5ja2V5LCBpbml0X2l2KSwNCiAgICAgICAgICAgICJzZXNzaW9uaWQiOiBiaW5hc2NpaS5oZXhsaWZ5KHNlbGYuc2Vzc2lvbmlkLmVuY29kZSgpKSwNCiAgICAgICAgICAgICJuYW1lIjogYmluYXNjaWkuaGV4bGlmeShzZWxmLm5hbWUuZW5jb2RlKCkpLA0KICAgICAgICAgICAgIm93bmVyaWQiOiBiaW5hc2NpaS5oZXhsaWZ5KHNlbGYub3duZXJpZC5lbmNvZGUoKSksDQogICAgICAgICAgICAiaW5pdF9pdiI6IGluaXRfaXYNCiAgICAgICAgfQ0KDQogICAgICAgIHJlc3BvbnNlID0gc2VsZi5fX2RvX3JlcXVlc3QocG9zdF9kYXRhKQ0KICAgICAgICByZXNwb25zZSA9IGVuY3J5cHRpb24uZGVjcnlwdChyZXNwb25zZSwgc2VsZi5lbmNrZXksIGluaXRfaXYpDQogICAgICAgIGpzb24gPSBqc29uZC5sb2FkcyhyZXNwb25zZSkNCg0KICAgICAgICBpZiBqc29uWyJzdWNjZXNzIl06DQogICAgICAgICAgICBwcmludCgic3VjY2Vzc2Z1bGx5IHJlZ2lzdGVyZWQiKQ0KICAgICAgICAgICAgc2VsZi5fX2xvYWRfdXNlcl9kYXRhKGpzb25bImluZm8iXSkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHByaW50KGpzb25bIm1lc3NhZ2UiXSkNCiAgICAgICAgICAgIG9zLl9leGl0KDEpDQoNCiAgICBkZWYgdXBncmFkZShzZWxmLCB1c2VyLCBsaWNlbnNlKToNCiAgICAgICAgc2VsZi5jaGVja2luaXQoKQ0KICAgICAgICBpbml0X2l2ID0gU0hBMjU2Lm5ldyhzdHIodXVpZDQoKSlbOjhdLmVuY29kZSgpKS5oZXhkaWdlc3QoKQ0KDQogICAgICAgIHBvc3RfZGF0YSA9IHsNCiAgICAgICAgICAgICJ0eXBlIjogYmluYXNjaWkuaGV4bGlmeSgidXBncmFkZSIuZW5jb2RlKCkpLA0KICAgICAgICAgICAgInVzZXJuYW1lIjogZW5jcnlwdGlvbi5lbmNyeXB0KHVzZXIsIHNlbGYuZW5ja2V5LCBpbml0X2l2KSwNCiAgICAgICAgICAgICJrZXkiOiBlbmNyeXB0aW9uLmVuY3J5cHQobGljZW5zZSwgc2VsZi5lbmNrZXksIGluaXRfaXYpLA0KICAgICAgICAgICAgInNlc3Npb25pZCI6IGJpbmFzY2lpLmhleGxpZnkoc2VsZi5zZXNzaW9uaWQuZW5jb2RlKCkpLA0KICAgICAgICAgICAgIm5hbWUiOiBiaW5hc2NpaS5oZXhsaWZ5KHNlbGYubmFtZS5lbmNvZGUoKSksDQogICAgICAgICAgICAib3duZXJpZCI6IGJpbmFzY2lpLmhleGxpZnkoc2VsZi5vd25lcmlkLmVuY29kZSgpKSwNCiAgICAgICAgICAgICJpbml0X2l2IjogaW5pdF9pdg0KICAgICAgICB9DQoNCiAgICAgICAgcmVzcG9uc2UgPSBzZWxmLl9fZG9fcmVxdWVzdChwb3N0X2RhdGEpDQoNCiAgICAgICAgcmVzcG9uc2UgPSBlbmNyeXB0aW9uLmRlY3J5cHQocmVzcG9uc2UsIHNlbGYuZW5ja2V5LCBpbml0X2l2KQ0KDQogICAgICAgIGpzb24gPSBqc29uZC5sb2FkcyhyZXNwb25zZSkNCg0KICAgICAgICBpZiBqc29uWyJzdWNjZXNzIl06DQogICAgICAgICAgICBwcmludCgic3VjY2Vzc2Z1bGx5IHVwZ3JhZGVkIHVzZXIiKQ0KICAgICAgICAgICAgcHJpbnQoInBsZWFzZSByZXN0YXJ0IHByb2dyYW0gYW5kIGxvZ2luIikNCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMikNCiAgICAgICAgICAgIG9zLl9leGl0KDEpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBwcmludChqc29uWyJtZXNzYWdlIl0pDQogICAgICAgICAgICBvcy5fZXhpdCgxKQ0KDQogICAgZGVmIGxvZ2luKHNlbGYsIHVzZXIsIHBhc3N3b3JkLCBod2lkPU5vbmUpOg0KICAgICAgICBzZWxmLmNoZWNraW5pdCgpDQogICAgICAgIGlmIGh3aWQgaXMgTm9uZToNCiAgICAgICAgICAgIGh3aWQgPSBvdGhlcnMuZ2V0X2h3aWQoKQ0KDQogICAgICAgIGluaXRfaXYgPSBTSEEyNTYubmV3KHN0cih1dWlkNCgpKVs6OF0uZW5jb2RlKCkpLmhleGRpZ2VzdCgpDQoNCiAgICAgICAgcG9zdF9kYXRhID0gew0KICAgICAgICAgICAgInR5cGUiOiBiaW5hc2NpaS5oZXhsaWZ5KCJsb2dpbiIuZW5jb2RlKCkpLA0KICAgICAgICAgICAgInVzZXJuYW1lIjogZW5jcnlwdGlvbi5lbmNyeXB0KHVzZXIsIHNlbGYuZW5ja2V5LCBpbml0X2l2KSwNCiAgICAgICAgICAgICJwYXNzIjogZW5jcnlwdGlvbi5lbmNyeXB0KHBhc3N3b3JkLCBzZWxmLmVuY2tleSwgaW5pdF9pdiksDQogICAgICAgICAgICAiaHdpZCI6IGVuY3J5cHRpb24uZW5jcnlwdChod2lkLCBzZWxmLmVuY2tleSwgaW5pdF9pdiksDQogICAgICAgICAgICAic2Vzc2lvbmlkIjogYmluYXNjaWkuaGV4bGlmeShzZWxmLnNlc3Npb25pZC5lbmNvZGUoKSksDQogICAgICAgICAgICAibmFtZSI6IGJpbmFzY2lpLmhleGxpZnkoc2VsZi5uYW1lLmVuY29kZSgpKSwNCiAgICAgICAgICAgICJvd25lcmlkIjogYmluYXNjaWkuaGV4bGlmeShzZWxmLm93bmVyaWQuZW5jb2RlKCkpLA0KICAgICAgICAgICAgImluaXRfaXYiOiBpbml0X2l2DQogICAgICAgIH0NCg0KICAgICAgICByZXNwb25zZSA9IHNlbGYuX19kb19yZXF1ZXN0KHBvc3RfZGF0YSkNCg0KICAgICAgICByZXNwb25zZSA9IGVuY3J5cHRpb24uZGVjcnlwdChyZXNwb25zZSwgc2VsZi5lbmNrZXksIGluaXRfaXYpDQoNCiAgICAgICAganNvbiA9IGpzb25kLmxvYWRzKHJlc3BvbnNlKQ0KDQogICAgICAgIGlmIGpzb25bInN1Y2Nlc3MiXToNCiAgICAgICAgICAgIHNlbGYuX19sb2FkX3VzZXJfZGF0YShqc29uWyJpbmZvIl0pDQogICAgICAgICAgICBwcmludCgic3VjY2Vzc2Z1bGx5IGxvZ2dlZCBpbiIpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBwcmludChqc29uWyJtZXNzYWdlIl0pDQogICAgICAgICAgICBvcy5fZXhpdCgxKQ0KDQogICAgZGVmIGxpY2Vuc2Uoc2VsZiwga2V5LCBod2lkPU5vbmUpOg0KICAgICAgICBzZWxmLmNoZWNraW5pdCgpDQogICAgICAgIGlmIGh3aWQgaXMgTm9uZToNCiAgICAgICAgICAgIGh3aWQgPSBvdGhlcnMuZ2V0X2h3aWQoKQ0KDQogICAgICAgIGluaXRfaXYgPSBTSEEyNTYubmV3KHN0cih1dWlkNCgpKVs6OF0uZW5jb2RlKCkpLmhleGRpZ2VzdCgpDQoNCiAgICAgICAgcG9zdF9kYXRhID0gew0KICAgICAgICAgICAgInR5cGUiOiBiaW5hc2NpaS5oZXhsaWZ5KCJsaWNlbnNlIi5lbmNvZGUoKSksDQogICAgICAgICAgICAia2V5IjogZW5jcnlwdGlvbi5lbmNyeXB0KGtleSwgc2VsZi5lbmNrZXksIGluaXRfaXYpLA0KICAgICAgICAgICAgImh3aWQiOiBlbmNyeXB0aW9uLmVuY3J5cHQoaHdpZCwgc2VsZi5lbmNrZXksIGluaXRfaXYpLA0KICAgICAgICAgICAgInNlc3Npb25pZCI6IGJpbmFzY2lpLmhleGxpZnkoc2VsZi5zZXNzaW9uaWQuZW5jb2RlKCkpLA0KICAgICAgICAgICAgIm5hbWUiOiBiaW5hc2NpaS5oZXhsaWZ5KHNlbGYubmFtZS5lbmNvZGUoKSksDQogICAgICAgICAgICAib3duZXJpZCI6IGJpbmFzY2lpLmhleGxpZnkoc2VsZi5vd25lcmlkLmVuY29kZSgpKSwNCiAgICAgICAgICAgICJpbml0X2l2IjogaW5pdF9pdg0KICAgICAgICB9DQoNCiAgICAgICAgcmVzcG9uc2UgPSBzZWxmLl9fZG9fcmVxdWVzdChwb3N0X2RhdGEpDQogICAgICAgIHJlc3BvbnNlID0gZW5jcnlwdGlvbi5kZWNyeXB0KHJlc3BvbnNlLCBzZWxmLmVuY2tleSwgaW5pdF9pdikNCg0KICAgICAgICBqc29uID0ganNvbmQubG9hZHMocmVzcG9uc2UpDQoNCiAgICAgICAgaWYganNvblsic3VjY2VzcyJdOg0KICAgICAgICAgICAgc2VsZi5fX2xvYWRfdXNlcl9kYXRhKGpzb25bImluZm8iXSkNCiAgICAgICAgICAgIHByaW50KCJzdWNjZXNzZnVsbHkgbG9nZ2VkIGludG8gbGljZW5zZSIpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBwcmludChqc29uWyJtZXNzYWdlIl0pDQogICAgICAgICAgICBvcy5fZXhpdCgxKQ0KDQogICAgZGVmIHZhcihzZWxmLCBuYW1lKToNCiAgICAgICAgc2VsZi5jaGVja2luaXQoKQ0KICAgICAgICBpbml0X2l2ID0gU0hBMjU2Lm5ldyhzdHIodXVpZDQoKSlbOjhdLmVuY29kZSgpKS5oZXhkaWdlc3QoKQ0KDQogICAgICAgIHBvc3RfZGF0YSA9IHsNCiAgICAgICAgICAgICJ0eXBlIjogYmluYXNjaWkuaGV4bGlmeSgidmFyIi5lbmNvZGUoKSksDQogICAgICAgICAgICAidmFyaWQiOiBlbmNyeXB0aW9uLmVuY3J5cHQobmFtZSwgc2VsZi5lbmNrZXksIGluaXRfaXYpLA0KICAgICAgICAgICAgInNlc3Npb25pZCI6IGJpbmFzY2lpLmhleGxpZnkoc2VsZi5zZXNzaW9uaWQuZW5jb2RlKCkpLA0KICAgICAgICAgICAgIm5hbWUiOiBiaW5hc2NpaS5oZXhsaWZ5KHNlbGYubmFtZS5lbmNvZGUoKSksDQogICAgICAgICAgICAib3duZXJpZCI6IGJpbmFzY2lpLmhleGxpZnkoc2VsZi5vd25lcmlkLmVuY29kZSgpKSwNCiAgICAgICAgICAgICJpbml0X2l2IjogaW5pdF9pdg0KICAgICAgICB9DQoNCiAgICAgICAgcmVzcG9uc2UgPSBzZWxmLl9fZG9fcmVxdWVzdChwb3N0X2RhdGEpDQoNCiAgICAgICAgcmVzcG9uc2UgPSBlbmNyeXB0aW9uLmRlY3J5cHQocmVzcG9uc2UsIHNlbGYuZW5ja2V5LCBpbml0X2l2KQ0KDQogICAgICAgIGpzb24gPSBqc29uZC5sb2FkcyhyZXNwb25zZSkNCg0KICAgICAgICBpZiBqc29uWyJzdWNjZXNzIl06DQogICAgICAgICAgICByZXR1cm4ganNvblsibWVzc2FnZSJdDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBwcmludChqc29uWyJtZXNzYWdlIl0pDQogICAgICAgICAgICB0aW1lLnNsZWVwKDUpDQogICAgICAgICAgICBvcy5fZXhpdCgxKQ0KDQogICAgZGVmIGdldHZhcihzZWxmLCB2YXJfbmFtZSk6DQogICAgICAgIHNlbGYuY2hlY2tpbml0KCkNCiAgICAgICAgaW5pdF9pdiA9IFNIQTI1Ni5uZXcoc3RyKHV1aWQ0KCkpWzo4XS5lbmNvZGUoKSkuaGV4ZGlnZXN0KCkNCg0KICAgICAgICBwb3N0X2RhdGEgPSB7DQogICAgICAgICAgICAidHlwZSI6IGJpbmFzY2lpLmhleGxpZnkoImdldHZhciIuZW5jb2RlKCkpLA0KICAgICAgICAgICAgInZhciI6IGVuY3J5cHRpb24uZW5jcnlwdCh2YXJfbmFtZSwgc2VsZi5lbmNrZXksIGluaXRfaXYpLA0KICAgICAgICAgICAgInNlc3Npb25pZCI6IGJpbmFzY2lpLmhleGxpZnkoc2VsZi5zZXNzaW9uaWQuZW5jb2RlKCkpLA0KICAgICAgICAgICAgIm5hbWUiOiBiaW5hc2NpaS5oZXhsaWZ5KHNlbGYubmFtZS5lbmNvZGUoKSksDQogICAgICAgICAgICAib3duZXJpZCI6IGJpbmFzY2lpLmhleGxpZnkoc2VsZi5vd25lcmlkLmVuY29kZSgpKSwNCiAgICAgICAgICAgICJpbml0X2l2IjogaW5pdF9pdg0KICAgICAgICB9DQogICAgICAgIHJlc3BvbnNlID0gc2VsZi5fX2RvX3JlcXVlc3QocG9zdF9kYXRhKQ0KICAgICAgICByZXNwb25zZSA9IGVuY3J5cHRpb24uZGVjcnlwdChyZXNwb25zZSwgc2VsZi5lbmNrZXksIGluaXRfaXYpDQogICAgICAgIGpzb24gPSBqc29uZC5sb2FkcyhyZXNwb25zZSkNCg0KICAgICAgICBpZiBqc29uWyJzdWNjZXNzIl06DQogICAgICAgICAgICByZXR1cm4ganNvblsicmVzcG9uc2UiXQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcHJpbnQoanNvblsibWVzc2FnZSJdKQ0KICAgICAgICAgICAgdGltZS5zbGVlcCg1KQ0KICAgICAgICAgICAgb3MuX2V4aXQoMSkNCg0KICAgIGRlZiBzZXR2YXIoc2VsZiwgdmFyX25hbWUsIHZhcl9kYXRhKToNCiAgICAgICAgc2VsZi5jaGVja2luaXQoKQ0KICAgICAgICBpbml0X2l2ID0gU0hBMjU2Lm5ldyhzdHIodXVpZDQoKSlbOjhdLmVuY29kZSgpKS5oZXhkaWdlc3QoKQ0KICAgICAgICBwb3N0X2RhdGEgPSB7DQogICAgICAgICAgICAidHlwZSI6IGJpbmFzY2lpLmhleGxpZnkoInNldHZhciIuZW5jb2RlKCkpLA0KICAgICAgICAgICAgInZhciI6IGVuY3J5cHRpb24uZW5jcnlwdCh2YXJfbmFtZSwgc2VsZi5lbmNrZXksIGluaXRfaXYpLA0KICAgICAgICAgICAgImRhdGEiOiBlbmNyeXB0aW9uLmVuY3J5cHQodmFyX2RhdGEsIHNlbGYuZW5ja2V5LCBpbml0X2l2KSwNCiAgICAgICAgICAgICJzZXNzaW9uaWQiOiBiaW5hc2NpaS5oZXhsaWZ5KHNlbGYuc2Vzc2lvbmlkLmVuY29kZSgpKSwNCiAgICAgICAgICAgICJuYW1lIjogYmluYXNjaWkuaGV4bGlmeShzZWxmLm5hbWUuZW5jb2RlKCkpLA0KICAgICAgICAgICAgIm93bmVyaWQiOiBiaW5hc2NpaS5oZXhsaWZ5KHNlbGYub3duZXJpZC5lbmNvZGUoKSksDQogICAgICAgICAgICAiaW5pdF9pdiI6IGluaXRfaXYNCiAgICAgICAgfQ0KICAgICAgICByZXNwb25zZSA9IHNlbGYuX19kb19yZXF1ZXN0KHBvc3RfZGF0YSkNCiAgICAgICAgcmVzcG9uc2UgPSBlbmNyeXB0aW9uLmRlY3J5cHQocmVzcG9uc2UsIHNlbGYuZW5ja2V5LCBpbml0X2l2KQ0KICAgICAgICBqc29uID0ganNvbmQubG9hZHMocmVzcG9uc2UpDQoNCiAgICAgICAgaWYganNvblsic3VjY2VzcyJdOg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHByaW50KGpzb25bIm1lc3NhZ2UiXSkNCiAgICAgICAgICAgIHRpbWUuc2xlZXAoNSkNCiAgICAgICAgICAgIG9zLl9leGl0KDEpDQoNCiAgICBkZWYgYmFuKHNlbGYpOg0KICAgICAgICBzZWxmLmNoZWNraW5pdCgpDQogICAgICAgIGluaXRfaXYgPSBTSEEyNTYubmV3KHN0cih1dWlkNCgpKVs6OF0uZW5jb2RlKCkpLmhleGRpZ2VzdCgpDQogICAgICAgIHBvc3RfZGF0YSA9IHsNCiAgICAgICAgICAgICJ0eXBlIjogYmluYXNjaWkuaGV4bGlmeSgiYmFuIi5lbmNvZGUoKSksDQogICAgICAgICAgICAic2Vzc2lvbmlkIjogYmluYXNjaWkuaGV4bGlmeShzZWxmLnNlc3Npb25pZC5lbmNvZGUoKSksDQogICAgICAgICAgICAibmFtZSI6IGJpbmFzY2lpLmhleGxpZnkoc2VsZi5uYW1lLmVuY29kZSgpKSwNCiAgICAgICAgICAgICJvd25lcmlkIjogYmluYXNjaWkuaGV4bGlmeShzZWxmLm93bmVyaWQuZW5jb2RlKCkpLA0KICAgICAgICAgICAgImluaXRfaXYiOiBpbml0X2l2DQogICAgICAgIH0NCiAgICAgICAgcmVzcG9uc2UgPSBzZWxmLl9fZG9fcmVxdWVzdChwb3N0X2RhdGEpDQogICAgICAgIHJlc3BvbnNlID0gZW5jcnlwdGlvbi5kZWNyeXB0KHJlc3BvbnNlLCBzZWxmLmVuY2tleSwgaW5pdF9pdikNCiAgICAgICAganNvbiA9IGpzb25kLmxvYWRzKHJlc3BvbnNlKQ0KDQogICAgICAgIGlmIGpzb25bInN1Y2Nlc3MiXToNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBwcmludChqc29uWyJtZXNzYWdlIl0pDQogICAgICAgICAgICB0aW1lLnNsZWVwKDUpDQogICAgICAgICAgICBvcy5fZXhpdCgxKQ0KDQogICAgZGVmIGZpbGUoc2VsZiwgZmlsZWlkKToNCiAgICAgICAgc2VsZi5jaGVja2luaXQoKQ0KICAgICAgICBpbml0X2l2ID0gU0hBMjU2Lm5ldyhzdHIodXVpZDQoKSlbOjhdLmVuY29kZSgpKS5oZXhkaWdlc3QoKQ0KDQogICAgICAgIHBvc3RfZGF0YSA9IHsNCiAgICAgICAgICAgICJ0eXBlIjogYmluYXNjaWkuaGV4bGlmeSgiZmlsZSIuZW5jb2RlKCkpLA0KICAgICAgICAgICAgImZpbGVpZCI6IGVuY3J5cHRpb24uZW5jcnlwdChmaWxlaWQsIHNlbGYuZW5ja2V5LCBpbml0X2l2KSwNCiAgICAgICAgICAgICJzZXNzaW9uaWQiOiBiaW5hc2NpaS5oZXhsaWZ5KHNlbGYuc2Vzc2lvbmlkLmVuY29kZSgpKSwNCiAgICAgICAgICAgICJuYW1lIjogYmluYXNjaWkuaGV4bGlmeShzZWxmLm5hbWUuZW5jb2RlKCkpLA0KICAgICAgICAgICAgIm93bmVyaWQiOiBiaW5hc2NpaS5oZXhsaWZ5KHNlbGYub3duZXJpZC5lbmNvZGUoKSksDQogICAgICAgICAgICAiaW5pdF9pdiI6IGluaXRfaXYNCiAgICAgICAgfQ0KDQogICAgICAgIHJlc3BvbnNlID0gc2VsZi5fX2RvX3JlcXVlc3QocG9zdF9kYXRhKQ0KDQogICAgICAgIHJlc3BvbnNlID0gZW5jcnlwdGlvbi5kZWNyeXB0KHJlc3BvbnNlLCBzZWxmLmVuY2tleSwgaW5pdF9pdikNCg0KICAgICAgICBqc29uID0ganNvbmQubG9hZHMocmVzcG9uc2UpDQoNCiAgICAgICAgaWYgbm90IGpzb25bInN1Y2Nlc3MiXToNCiAgICAgICAgICAgIHByaW50KGpzb25bIm1lc3NhZ2UiXSkNCiAgICAgICAgICAgIHRpbWUuc2xlZXAoNSkNCiAgICAgICAgICAgIG9zLl9leGl0KDEpDQogICAgICAgIHJldHVybiBiaW5hc2NpaS51bmhleGxpZnkoanNvblsiY29udGVudHMiXSkNCg0KICAgIGRlZiB3ZWJob29rKHNlbGYsIHdlYmlkLCBwYXJhbSwgYm9keSA9ICIiLCBjb250dHlwZSA9ICIiKToNCiAgICAgICAgc2VsZi5jaGVja2luaXQoKQ0KICAgICAgICBpbml0X2l2ID0gU0hBMjU2Lm5ldyhzdHIodXVpZDQoKSlbOjhdLmVuY29kZSgpKS5oZXhkaWdlc3QoKQ0KDQogICAgICAgIHBvc3RfZGF0YSA9IHsNCiAgICAgICAgICAgICJ0eXBlIjogYmluYXNjaWkuaGV4bGlmeSgid2ViaG9vayIuZW5jb2RlKCkpLA0KICAgICAgICAgICAgIndlYmlkIjogZW5jcnlwdGlvbi5lbmNyeXB0KHdlYmlkLCBzZWxmLmVuY2tleSwgaW5pdF9pdiksDQogICAgICAgICAgICAicGFyYW1zIjogZW5jcnlwdGlvbi5lbmNyeXB0KHBhcmFtLCBzZWxmLmVuY2tleSwgaW5pdF9pdiksDQogICAgICAgICAgICAiYm9keSI6IGVuY3J5cHRpb24uZW5jcnlwdChib2R5LCBzZWxmLmVuY2tleSwgaW5pdF9pdiksDQogICAgICAgICAgICAiY29udHR5cGUiOiBlbmNyeXB0aW9uLmVuY3J5cHQoY29udHR5cGUsIHNlbGYuZW5ja2V5LCBpbml0X2l2KSwNCiAgICAgICAgICAgICJzZXNzaW9uaWQiOiBiaW5hc2NpaS5oZXhsaWZ5KHNlbGYuc2Vzc2lvbmlkLmVuY29kZSgpKSwNCiAgICAgICAgICAgICJuYW1lIjogYmluYXNjaWkuaGV4bGlmeShzZWxmLm5hbWUuZW5jb2RlKCkpLA0KICAgICAgICAgICAgIm93bmVyaWQiOiBiaW5hc2NpaS5oZXhsaWZ5KHNlbGYub3duZXJpZC5lbmNvZGUoKSksDQogICAgICAgICAgICAiaW5pdF9pdiI6IGluaXRfaXYNCiAgICAgICAgfQ0KDQogICAgICAgIHJlc3BvbnNlID0gc2VsZi5fX2RvX3JlcXVlc3QocG9zdF9kYXRhKQ0KDQogICAgICAgIHJlc3BvbnNlID0gZW5jcnlwdGlvbi5kZWNyeXB0KHJlc3BvbnNlLCBzZWxmLmVuY2tleSwgaW5pdF9pdikNCiAgICAgICAganNvbiA9IGpzb25kLmxvYWRzKHJlc3BvbnNlKQ0KDQogICAgICAgIGlmIGpzb25bInN1Y2Nlc3MiXToNCiAgICAgICAgICAgIHJldHVybiBqc29uWyJtZXNzYWdlIl0NCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHByaW50KGpzb25bIm1lc3NhZ2UiXSkNCiAgICAgICAgICAgIHRpbWUuc2xlZXAoNSkNCiAgICAgICAgICAgIG9zLl9leGl0KDEpDQoNCiAgICBkZWYgY2hlY2soc2VsZik6DQogICAgICAgIHNlbGYuY2hlY2tpbml0KCkNCiAgICAgICAgaW5pdF9pdiA9IFNIQTI1Ni5uZXcoc3RyKHV1aWQ0KCkpWzo4XS5lbmNvZGUoKSkuaGV4ZGlnZXN0KCkNCiAgICAgICAgcG9zdF9kYXRhID0gew0KICAgICAgICAgICAgInR5cGUiOiBiaW5hc2NpaS5oZXhsaWZ5KCJjaGVjayIuZW5jb2RlKCkpLA0KICAgICAgICAgICAgInNlc3Npb25pZCI6IGJpbmFzY2lpLmhleGxpZnkoc2VsZi5zZXNzaW9uaWQuZW5jb2RlKCkpLA0KICAgICAgICAgICAgIm5hbWUiOiBiaW5hc2NpaS5oZXhsaWZ5KHNlbGYubmFtZS5lbmNvZGUoKSksDQogICAgICAgICAgICAib3duZXJpZCI6IGJpbmFzY2lpLmhleGxpZnkoc2VsZi5vd25lcmlkLmVuY29kZSgpKSwNCiAgICAgICAgICAgICJpbml0X2l2IjogaW5pdF9pdg0KICAgICAgICB9DQogICAgICAgIHJlc3BvbnNlID0gc2VsZi5fX2RvX3JlcXVlc3QocG9zdF9kYXRhKQ0KDQogICAgICAgIHJlc3BvbnNlID0gZW5jcnlwdGlvbi5kZWNyeXB0KHJlc3BvbnNlLCBzZWxmLmVuY2tleSwgaW5pdF9pdikNCiAgICAgICAganNvbiA9IGpzb25kLmxvYWRzKHJlc3BvbnNlKQ0KICAgICAgICBpZiBqc29uWyJzdWNjZXNzIl06DQogICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICBkZWYgY2hlY2tibGFja2xpc3Qoc2VsZik6DQogICAgICAgIHNlbGYuY2hlY2tpbml0KCkNCiAgICAgICAgaHdpZCA9IG90aGVycy5nZXRfaHdpZCgpDQogICAgICAgIGluaXRfaXYgPSBTSEEyNTYubmV3KHN0cih1dWlkNCgpKVs6OF0uZW5jb2RlKCkpLmhleGRpZ2VzdCgpDQogICAgICAgIHBvc3RfZGF0YSA9IHsNCiAgICAgICAgICAgICJ0eXBlIjogYmluYXNjaWkuaGV4bGlmeSgiY2hlY2tibGFja2xpc3QiLmVuY29kZSgpKSwNCiAgICAgICAgICAgICJod2lkIjogZW5jcnlwdGlvbi5lbmNyeXB0KGh3aWQsIHNlbGYuZW5ja2V5LCBpbml0X2l2KSwNCiAgICAgICAgICAgICJzZXNzaW9uaWQiOiBiaW5hc2NpaS5oZXhsaWZ5KHNlbGYuc2Vzc2lvbmlkLmVuY29kZSgpKSwNCiAgICAgICAgICAgICJuYW1lIjogYmluYXNjaWkuaGV4bGlmeShzZWxmLm5hbWUuZW5jb2RlKCkpLA0KICAgICAgICAgICAgIm93bmVyaWQiOiBiaW5hc2NpaS5oZXhsaWZ5KHNlbGYub3duZXJpZC5lbmNvZGUoKSksDQogICAgICAgICAgICAiaW5pdF9pdiI6IGluaXRfaXYNCiAgICAgICAgfQ0KICAgICAgICByZXNwb25zZSA9IHNlbGYuX19kb19yZXF1ZXN0KHBvc3RfZGF0YSkNCg0KICAgICAgICByZXNwb25zZSA9IGVuY3J5cHRpb24uZGVjcnlwdChyZXNwb25zZSwgc2VsZi5lbmNrZXksIGluaXRfaXYpDQogICAgICAgIGpzb24gPSBqc29uZC5sb2FkcyhyZXNwb25zZSkNCiAgICAgICAgaWYganNvblsic3VjY2VzcyJdOg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgZGVmIGxvZyhzZWxmLCBtZXNzYWdlKToNCiAgICAgICAgc2VsZi5jaGVja2luaXQoKQ0KICAgICAgICBpbml0X2l2ID0gU0hBMjU2Lm5ldyhzdHIodXVpZDQoKSlbOjhdLmVuY29kZSgpKS5oZXhkaWdlc3QoKQ0KDQogICAgICAgIHBvc3RfZGF0YSA9IHsNCiAgICAgICAgICAgICJ0eXBlIjogYmluYXNjaWkuaGV4bGlmeSgibG9nIi5lbmNvZGUoKSksDQogICAgICAgICAgICAicGN1c2VyIjogZW5jcnlwdGlvbi5lbmNyeXB0KG9zLmdldGVudigndXNlcm5hbWUnKSwgc2VsZi5lbmNrZXksIGluaXRfaXYpLA0KICAgICAgICAgICAgIm1lc3NhZ2UiOiBlbmNyeXB0aW9uLmVuY3J5cHQobWVzc2FnZSwgc2VsZi5lbmNrZXksIGluaXRfaXYpLA0KICAgICAgICAgICAgInNlc3Npb25pZCI6IGJpbmFzY2lpLmhleGxpZnkoc2VsZi5zZXNzaW9uaWQuZW5jb2RlKCkpLA0KICAgICAgICAgICAgIm5hbWUiOiBiaW5hc2NpaS5oZXhsaWZ5KHNlbGYubmFtZS5lbmNvZGUoKSksDQogICAgICAgICAgICAib3duZXJpZCI6IGJpbmFzY2lpLmhleGxpZnkoc2VsZi5vd25lcmlkLmVuY29kZSgpKSwNCiAgICAgICAgICAgICJpbml0X2l2IjogaW5pdF9pdg0KICAgICAgICB9DQoNCiAgICAgICAgc2VsZi5fX2RvX3JlcXVlc3QocG9zdF9kYXRhKQ0KDQogICAgZGVmIGZldGNoT25saW5lKHNlbGYpOg0KICAgICAgICBzZWxmLmNoZWNraW5pdCgpDQogICAgICAgIGluaXRfaXYgPSBTSEEyNTYubmV3KHN0cih1dWlkNCgpKVs6OF0uZW5jb2RlKCkpLmhleGRpZ2VzdCgpDQoNCiAgICAgICAgcG9zdF9kYXRhID0gew0KICAgICAgICAgICAgInR5cGUiOiBiaW5hc2NpaS5oZXhsaWZ5KCJmZXRjaE9ubGluZSIuZW5jb2RlKCkpLA0KICAgICAgICAgICAgInNlc3Npb25pZCI6IGJpbmFzY2lpLmhleGxpZnkoc2VsZi5zZXNzaW9uaWQuZW5jb2RlKCkpLA0KICAgICAgICAgICAgIm5hbWUiOiBiaW5hc2NpaS5oZXhsaWZ5KHNlbGYubmFtZS5lbmNvZGUoKSksDQogICAgICAgICAgICAib3duZXJpZCI6IGJpbmFzY2lpLmhleGxpZnkoc2VsZi5vd25lcmlkLmVuY29kZSgpKSwNCiAgICAgICAgICAgICJpbml0X2l2IjogaW5pdF9pdg0KICAgICAgICB9DQoNCiAgICAgICAgcmVzcG9uc2UgPSBzZWxmLl9fZG9fcmVxdWVzdChwb3N0X2RhdGEpDQogICAgICAgIHJlc3BvbnNlID0gZW5jcnlwdGlvbi5kZWNyeXB0KHJlc3BvbnNlLCBzZWxmLmVuY2tleSwgaW5pdF9pdikNCg0KICAgICAgICBqc29uID0ganNvbmQubG9hZHMocmVzcG9uc2UpDQoNCiAgICAgICAgaWYganNvblsic3VjY2VzcyJdOg0KICAgICAgICAgICAgaWYgbGVuKGpzb25bInVzZXJzIl0pID09IDA6DQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUgICMgVEhJUyBJUyBJU1NVRSBPTiBLRVlBVVRIIFNFUlZFUiBTSURFIDYuOC4yMDIyLCBzbyBpdCB3aWxsIHJldHVybiBub25lIGlmIGl0IGlzIG5vdCBhbiBhcnJheS4NCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgcmV0dXJuIGpzb25bInVzZXJzIl0NCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBOb25lDQoNCiAgICBkZWYgY2hhdEdldChzZWxmLCBjaGFubmVsKToNCiAgICAgICAgc2VsZi5jaGVja2luaXQoKQ0KICAgICAgICBpbml0X2l2ID0gU0hBMjU2Lm5ldyhzdHIodXVpZDQoKSlbOjhdLmVuY29kZSgpKS5oZXhkaWdlc3QoKQ0KDQogICAgICAgIHBvc3RfZGF0YSA9IHsNCiAgICAgICAgICAgICJ0eXBlIjogYmluYXNjaWkuaGV4bGlmeSgiY2hhdGdldCIuZW5jb2RlKCkpLA0KICAgICAgICAgICAgImNoYW5uZWwiOiBlbmNyeXB0aW9uLmVuY3J5cHQoY2hhbm5lbCwgc2VsZi5lbmNrZXksIGluaXRfaXYpLA0KICAgICAgICAgICAgInNlc3Npb25pZCI6IGJpbmFzY2lpLmhleGxpZnkoc2VsZi5zZXNzaW9uaWQuZW5jb2RlKCkpLA0KICAgICAgICAgICAgIm5hbWUiOiBiaW5hc2NpaS5oZXhsaWZ5KHNlbGYubmFtZS5lbmNvZGUoKSksDQogICAgICAgICAgICAib3duZXJpZCI6IGJpbmFzY2lpLmhleGxpZnkoc2VsZi5vd25lcmlkLmVuY29kZSgpKSwNCiAgICAgICAgICAgICJpbml0X2l2IjogaW5pdF9pdg0KICAgICAgICB9DQoNCiAgICAgICAgcmVzcG9uc2UgPSBzZWxmLl9fZG9fcmVxdWVzdChwb3N0X2RhdGEpDQogICAgICAgIHJlc3BvbnNlID0gZW5jcnlwdGlvbi5kZWNyeXB0KHJlc3BvbnNlLCBzZWxmLmVuY2tleSwgaW5pdF9pdikNCg0KICAgICAgICBqc29uID0ganNvbmQubG9hZHMocmVzcG9uc2UpDQoNCiAgICAgICAgaWYganNvblsic3VjY2VzcyJdOg0KICAgICAgICAgICAgcmV0dXJuIGpzb25bIm1lc3NhZ2VzIl0NCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBOb25lDQoNCiAgICBkZWYgY2hhdFNlbmQoc2VsZiwgbWVzc2FnZSwgY2hhbm5lbCk6DQogICAgICAgIHNlbGYuY2hlY2tpbml0KCkNCiAgICAgICAgaW5pdF9pdiA9IFNIQTI1Ni5uZXcoc3RyKHV1aWQ0KCkpWzo4XS5lbmNvZGUoKSkuaGV4ZGlnZXN0KCkNCg0KICAgICAgICBwb3N0X2RhdGEgPSB7DQogICAgICAgICAgICAidHlwZSI6IGJpbmFzY2lpLmhleGxpZnkoImNoYXRzZW5kIi5lbmNvZGUoKSksDQogICAgICAgICAgICAibWVzc2FnZSI6IGVuY3J5cHRpb24uZW5jcnlwdChtZXNzYWdlLCBzZWxmLmVuY2tleSwgaW5pdF9pdiksDQogICAgICAgICAgICAiY2hhbm5lbCI6IGVuY3J5cHRpb24uZW5jcnlwdChjaGFubmVsLCBzZWxmLmVuY2tleSwgaW5pdF9pdiksDQogICAgICAgICAgICAic2Vzc2lvbmlkIjogYmluYXNjaWkuaGV4bGlmeShzZWxmLnNlc3Npb25pZC5lbmNvZGUoKSksDQogICAgICAgICAgICAibmFtZSI6IGJpbmFzY2lpLmhleGxpZnkoc2VsZi5uYW1lLmVuY29kZSgpKSwNCiAgICAgICAgICAgICJvd25lcmlkIjogYmluYXNjaWkuaGV4bGlmeShzZWxmLm93bmVyaWQuZW5jb2RlKCkpLA0KICAgICAgICAgICAgImluaXRfaXYiOiBpbml0X2l2DQogICAgICAgIH0NCg0KICAgICAgICByZXNwb25zZSA9IHNlbGYuX19kb19yZXF1ZXN0KHBvc3RfZGF0YSkNCiAgICAgICAgcmVzcG9uc2UgPSBlbmNyeXB0aW9uLmRlY3J5cHQocmVzcG9uc2UsIHNlbGYuZW5ja2V5LCBpbml0X2l2KQ0KDQogICAgICAgIGpzb24gPSBqc29uZC5sb2FkcyhyZXNwb25zZSkNCg0KICAgICAgICBpZiBqc29uWyJzdWNjZXNzIl06DQogICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICBkZWYgY2hlY2tpbml0KHNlbGYpOg0KICAgICAgICBpZiBub3Qgc2VsZi5pbml0aWFsaXplZDoNCiAgICAgICAgICAgIHByaW50KCJJbml0aWFsaXplIGZpcnN0LCBpbiBvcmRlciB0byB1c2UgdGhlIGZ1bmN0aW9ucyIpDQogICAgICAgICAgICB0aW1lLnNsZWVwKDIpDQogICAgICAgICAgICBvcy5fZXhpdCgxKQ0KDQogICAgZGVmIGNoYW5nZVVzZXJuYW1lKHNlbGYsIHVzZXJuYW1lKToNCiAgICAgICAgc2VsZi5jaGVja2luaXQoKQ0KICAgICAgICBpbml0X2l2ID0gU0hBMjU2Lm5ldyhzdHIodXVpZDQoKSlbOjhdLmVuY29kZSgpKS5oZXhkaWdlc3QoKQ0KICAgICAgICBwb3N0X2RhdGEgPSB7DQogICAgICAgICAgICAidHlwZSI6IGJpbmFzY2lpLmhleGxpZnkoImNoYW5nZVVzZXJuYW1lIi5lbmNvZGUoKSksDQogICAgICAgICAgICAibmV3VXNlcm5hbWUiOiB1c2VybmFtZSwNCiAgICAgICAgICAgICJzZXNzaW9uaWQiOiBiaW5hc2NpaS5oZXhsaWZ5KHNlbGYuc2Vzc2lvbmlkLmVuY29kZSgpKSwNCiAgICAgICAgICAgICJuYW1lIjogYmluYXNjaWkuaGV4bGlmeShzZWxmLm5hbWUuZW5jb2RlKCkpLA0KICAgICAgICAgICAgIm93bmVyaWQiOiBiaW5hc2NpaS5oZXhsaWZ5KHNlbGYub3duZXJpZC5lbmNvZGUoKSksDQogICAgICAgICAgICAiaW5pdF9pdiI6IGluaXRfaXYNCiAgICAgICAgfQ0KDQogICAgICAgIHJlc3BvbnNlID0gc2VsZi5fX2RvX3JlcXVlc3QocG9zdF9kYXRhKQ0KICAgICAgICByZXNwb25zZSA9IGVuY3J5cHRpb24uZGVjcnlwdChyZXNwb25zZSwgc2VsZi5lbmNrZXksIGluaXRfaXYpDQogICAgICAgIGpzb24gPSBqc29uZC5sb2FkcyhyZXNwb25zZSkNCg0KICAgICAgICBpZiBqc29uWyJzdWNjZXNzIl06DQogICAgICAgICAgICBwcmludCgic3VjY2Vzc2Z1bGx5IENoYW5nZWQgVXNlcm5hbWUiKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcHJpbnQoanNvblsibWVzc2FnZSJdKQ0KICAgICAgICAgICAgb3MuX2V4aXQoMSkgICAgICAgIA0KICAgICAgICAgICAgDQogICAgZGVmIF9fZG9fcmVxdWVzdChzZWxmLCBwb3N0X2RhdGEpOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBycV9vdXQgPSBzLnBvc3QoDQogICAgICAgICAgICAgICAgImh0dHBzOi8va2V5YXV0aC53aW4vYXBpLzEuMC8iLCBkYXRhPXBvc3RfZGF0YSwgdGltZW91dD0zMA0KICAgICAgICAgICAgKQ0KICAgICAgICAgICAgcmV0dXJuIHJxX291dC50ZXh0DQogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlRpbWVvdXQ6DQogICAgICAgICAgICBwcmludCgiUmVxdWVzdCB0aW1lZCBvdXQiKQ0KDQogICAgY2xhc3MgYXBwbGljYXRpb25fZGF0YV9jbGFzczoNCiAgICAgICAgbnVtVXNlcnMgPSBudW1LZXlzID0gYXBwX3ZlciA9IGN1c3RvbWVyX3BhbmVsID0gb25saW5lVXNlcnMgPSAiIg0KICAgICMgcmVnaW9uIHVzZXJfZGF0YQ0KDQogICAgY2xhc3MgdXNlcl9kYXRhX2NsYXNzOg0KICAgICAgICB1c2VybmFtZSA9IGlwID0gaHdpZCA9IGV4cGlyZXMgPSBjcmVhdGVkYXRlID0gbGFzdGxvZ2luID0gc3Vic2NyaXB0aW9uID0gc3Vic2NyaXB0aW9ucyA9ICIiDQoNCiAgICB1c2VyX2RhdGEgPSB1c2VyX2RhdGFfY2xhc3MoKQ0KICAgIGFwcF9kYXRhID0gYXBwbGljYXRpb25fZGF0YV9jbGFzcygpDQoNCiAgICBkZWYgX19sb2FkX2FwcF9kYXRhKHNlbGYsIGRhdGEpOg0KICAgICAgICBzZWxmLmFwcF9kYXRhLm51bVVzZXJzID0gZGF0YVsibnVtVXNlcnMiXQ0KICAgICAgICBzZWxmLmFwcF9kYXRhLm51bUtleXMgPSBkYXRhWyJudW1LZXlzIl0NCiAgICAgICAgc2VsZi5hcHBfZGF0YS5hcHBfdmVyID0gZGF0YVsidmVyc2lvbiJdDQogICAgICAgIHNlbGYuYXBwX2RhdGEuY3VzdG9tZXJfcGFuZWwgPSBkYXRhWyJjdXN0b21lclBhbmVsTGluayJdDQogICAgICAgIHNlbGYuYXBwX2RhdGEub25saW5lVXNlcnMgPSBkYXRhWyJudW1PbmxpbmVVc2VycyJdDQoNCiAgICBkZWYgX19sb2FkX3VzZXJfZGF0YShzZWxmLCBkYXRhKToNCiAgICAgICAgc2VsZi51c2VyX2RhdGEudXNlcm5hbWUgPSBkYXRhWyJ1c2VybmFtZSJdDQogICAgICAgIHNlbGYudXNlcl9kYXRhLmlwID0gZGF0YVsiaXAiXQ0KICAgICAgICBzZWxmLnVzZXJfZGF0YS5od2lkID0gZGF0YVsiaHdpZCJdDQogICAgICAgIHNlbGYudXNlcl9kYXRhLmV4cGlyZXMgPSBkYXRhWyJzdWJzY3JpcHRpb25zIl1bMF1bImV4cGlyeSJdDQogICAgICAgIHNlbGYudXNlcl9kYXRhLmNyZWF0ZWRhdGUgPSBkYXRhWyJjcmVhdGVkYXRlIl0NCiAgICAgICAgc2VsZi51c2VyX2RhdGEubGFzdGxvZ2luID0gZGF0YVsibGFzdGxvZ2luIl0NCiAgICAgICAgc2VsZi51c2VyX2RhdGEuc3Vic2NyaXB0aW9uID0gZGF0YVsic3Vic2NyaXB0aW9ucyJdWzBdWyJzdWJzY3JpcHRpb24iXQ0KICAgICAgICBzZWxmLnVzZXJfZGF0YS5zdWJzY3JpcHRpb25zID0gZGF0YVsic3Vic2NyaXB0aW9ucyJdDQoNCg0KY2xhc3Mgb3RoZXJzOg0KICAgIEBzdGF0aWNtZXRob2QNCiAgICBkZWYgZ2V0X2h3aWQoKToNCiAgICAgICAgaWYgcGxhdGZvcm0uc3lzdGVtKCkgPT0gIkxpbnV4IjoNCiAgICAgICAgICAgIHdpdGggb3BlbigiL2V0Yy9tYWNoaW5lLWlkIikgYXMgZjoNCiAgICAgICAgICAgICAgICBod2lkID0gZi5yZWFkKCkNCiAgICAgICAgICAgICAgICByZXR1cm4gaHdpZA0KICAgICAgICBlbGlmIHBsYXRmb3JtLnN5c3RlbSgpID09ICdXaW5kb3dzJzoNCiAgICAgICAgICAgIHdpbnVzZXIgPSBvcy5nZXRsb2dpbigpDQogICAgICAgICAgICBzaWQgPSB3aW4zMnNlY3VyaXR5Lkxvb2t1cEFjY291bnROYW1lKE5vbmUsIHdpbnVzZXIpWzBdICAjIFlvdSBjYW4gYWxzbyB1c2UgV01JQyAoYmV0dGVyIHRoYW4gU0lELCBzb21lIHVzZXJzIGhhZCBwcm9ibGVtcyB3aXRoIFdNSUMpDQogICAgICAgICAgICBod2lkID0gd2luMzJzZWN1cml0eS5Db252ZXJ0U2lkVG9TdHJpbmdTaWQoc2lkKQ0KICAgICAgICAgICAgcmV0dXJuIGh3aWQNCiAgICAgICAgZWxpZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAnRGFyd2luJzoNCiAgICAgICAgICAgIG91dHB1dCA9IHN1YnByb2Nlc3MuUG9wZW4oImlvcmVnIC1sIHwgZ3JlcCBJT1BsYXRmb3JtU2VyaWFsTnVtYmVyIiwgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwgc2hlbGw9VHJ1ZSkuY29tbXVuaWNhdGUoKVswXQ0KICAgICAgICAgICAgc2VyaWFsID0gb3V0cHV0LmRlY29kZSgpLnNwbGl0KCc9JywgMSlbMV0ucmVwbGFjZSgnICcsICcnKQ0KICAgICAgICAgICAgaHdpZCA9IHNlcmlhbFsxOi0yXQ0KICAgICAgICAgICAgcmV0dXJuIGh3aWQNCg0KDQoNCmNsYXNzIGVuY3J5cHRpb246DQogICAgQHN0YXRpY21ldGhvZA0KICAgIGRlZiBlbmNyeXB0X3N0cmluZyhwbGFpbl90ZXh0LCBrZXksIGl2KToNCiAgICAgICAgcGxhaW5fdGV4dCA9IHBhZChwbGFpbl90ZXh0LCAxNikNCg0KICAgICAgICBhZXNfaW5zdGFuY2UgPSBBRVMubmV3KGtleSwgQUVTLk1PREVfQ0JDLCBpdikNCg0KICAgICAgICByYXdfb3V0ID0gYWVzX2luc3RhbmNlLmVuY3J5cHQocGxhaW5fdGV4dCkNCg0KICAgICAgICByZXR1cm4gYmluYXNjaWkuaGV4bGlmeShyYXdfb3V0KQ0KDQogICAgQHN0YXRpY21ldGhvZA0KICAgIGRlZiBkZWNyeXB0X3N0cmluZyhjaXBoZXJfdGV4dCwga2V5LCBpdik6DQogICAgICAgIGNpcGhlcl90ZXh0ID0gYmluYXNjaWkudW5oZXhsaWZ5KGNpcGhlcl90ZXh0KQ0KDQogICAgICAgIGFlc19pbnN0YW5jZSA9IEFFUy5uZXcoa2V5LCBBRVMuTU9ERV9DQkMsIGl2KQ0KDQogICAgICAgIGNpcGhlcl90ZXh0ID0gYWVzX2luc3RhbmNlLmRlY3J5cHQoY2lwaGVyX3RleHQpDQoNCiAgICAgICAgcmV0dXJuIHVucGFkKGNpcGhlcl90ZXh0LCAxNikNCg0KICAgIEBzdGF0aWNtZXRob2QNCiAgICBkZWYgZW5jcnlwdChtZXNzYWdlLCBlbmNfa2V5LCBpdik6DQogICAgICAgIHRyeToNCiAgICAgICAgICAgIF9rZXkgPSBTSEEyNTYubmV3KGVuY19rZXkuZW5jb2RlKCkpLmhleGRpZ2VzdCgpWzozMl0NCg0KICAgICAgICAgICAgX2l2ID0gU0hBMjU2Lm5ldyhpdi5lbmNvZGUoKSkuaGV4ZGlnZXN0KClbOjE2XQ0KDQogICAgICAgICAgICByZXR1cm4gZW5jcnlwdGlvbi5lbmNyeXB0X3N0cmluZyhtZXNzYWdlLmVuY29kZSgpLCBfa2V5LmVuY29kZSgpLCBfaXYuZW5jb2RlKCkpLmRlY29kZSgpDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHByaW50KCJJbnZhbGlkIEFwcGxpY2F0aW9uIEluZm9ybWF0aW9uLiBMb25nIHRleHQgaXMgc2VjcmV0IHNob3J0IHRleHQgaXMgb3duZXJpZC4gTmFtZSBpcyBzdXBwb3NlZCB0byBiZSBhcHAgbmFtZSBub3QgdXNlcm5hbWUiKQ0KICAgICAgICAgICAgb3MuX2V4aXQoMSkNCg0KICAgIEBzdGF0aWNtZXRob2QNCiAgICBkZWYgZGVjcnlwdChtZXNzYWdlLCBlbmNfa2V5LCBpdik6DQogICAgICAgIHRyeToNCiAgICAgICAgICAgIF9rZXkgPSBTSEEyNTYubmV3KGVuY19rZXkuZW5jb2RlKCkpLmhleGRpZ2VzdCgpWzozMl0NCg0KICAgICAgICAgICAgX2l2ID0gU0hBMjU2Lm5ldyhpdi5lbmNvZGUoKSkuaGV4ZGlnZXN0KClbOjE2XQ0KDQogICAgICAgICAgICByZXR1cm4gZW5jcnlwdGlvbi5kZWNyeXB0X3N0cmluZyhtZXNzYWdlLmVuY29kZSgpLCBfa2V5LmVuY29kZSgpLCBfaXYuZW5jb2RlKCkpLmRlY29kZSgpDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHByaW50KCJJbnZhbGlkIEFwcGxpY2F0aW9uIEluZm9ybWF0aW9uLiBMb25nIHRleHQgaXMgc2VjcmV0IHNob3J0IHRleHQgaXMgb3duZXJpZC4gTmFtZSBpcyBzdXBwb3NlZCB0byBiZSBhcHAgbmFtZSBub3QgdXNlcm5hbWUiKQ0KICAgICAgICAgICAgb3MuX2V4aXQoMSk=",
    "m2": "U3RvcCB0cnlpbmcgdG8gc3RlYWwgbXkgY29kZSE=",
    "m3": "U1RPUCE="
}
